{% extends "core/base.html" %}
{% load static %}

{% block title %}Generator Plan Alimentar{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-9">
            <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
                <div class="card-header text-white text-center py-5"
                    style="background: linear-gradient(135deg, #667eea, #764ba2);">
                    <h1 class="mb-0 fw-bold display-5">Planul tău alimentar personalizat</h1>
                    <p class="mb-0 mt-2 fs-5 opacity-90">Calculat 100% după nevoile tale</p>
                </div>

                <div class="card-body p-5">
                    <form hx-post="{% url 'generate-plan' %}" hx-target="#plan-result" hx-swap="innerHTML"
                        hx-indicator="#loading" class="needs-validation" novalidate>

                        {% csrf_token %}
                        <div class="row g-4">
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Vârsta</label>
                                <input type="number" name="age" min="15" max="100" class="form-control form-control-lg"
                                    required placeholder="ex: 32">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Gen</label>
                                <select name="gender" class="form-select form-control-lg" required>
                                    <option value="M">Bărbat</option>
                                    <option value="F">Femeie</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Greutate (kg)</label>
                                <input type="number" step="0.1" name="weight" class="form-control form-control-lg"
                                    required placeholder="ex: 78.5">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Înălțime (cm) <small
                                        class="text-muted">(opțional)</small></label>
                                <input type="number" name="height" class="form-control form-control-lg"
                                    placeholder="ex: 175">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Greutate țintă (kg) <small
                                        class="text-muted">(opțional)</small></label>
                                <input type="number" step="0.1" name="target_weight"
                                    class="form-control form-control-lg" placeholder="ex: 70">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Nivel de activitate</label>
                                <select name="activity_level" class="form-select form-control-lg" required>
                                    <option value="sedentary">Sedentar</option>
                                    <option value="light">Ușoară</option>
                                    <option value="moderate">Moderată</option>
                                    <option value="active">Intensă</option>
                                    <option value="very_active">Foarte intensă</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label fw-semibold">Tip dietă / Raport macro</label>
                                <select name="macro_ratio" class="form-select form-control-lg" required id="macro-select">
                                    <option value="" disabled selected>Alege raportul macronutrienți</option>
                                    {% for ratio in macro_ratios %}
                                    <option value="{{ ratio.id }}">
                                        {{ ratio.name }} → P:{{ ratio.proteins }}% | C:{{ ratio.carbs }}% | G:{{ ratio.fats }}%
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="text-center mt-5">
                            <button type="submit" class="btn btn-primary btn-lg px-5 shadow-lg">
                                Generează Planul Meu
                            </button>
                        </div>

                        <div id="loading" class="htmx-indicator text-center my-5">
                            <div class="spinner-border text-primary" style="width: 4rem; height: 4rem;"></div>
                            <p class="mt-3 fs-4 text-muted">Se creează planul tău perfect...</p>
                        </div>
                    </form>

                    <div id="plan-result" class="mt-5"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('macro-select')?.addEventListener('change', function () {
        const desc = this.selectedOptions[0].dataset.desc;
        const fiber = this.selectedOptions[0].dataset.fiber;
        const info = document.getElementById('macro-info');
        if (desc) {
            document.getElementById('macro-desc').textContent = desc;
            document.getElementById('fiber-text').textContent = fiber;
            info.style.display = 'block';
        } else {
            info.style.display = 'none';
        }
    });
</script>
{% endblock %}
